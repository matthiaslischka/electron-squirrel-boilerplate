<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upgrade</title>
    <link rel="stylesheet" href="styles.css">
</head>

<script>
    var remote = require('remote'),
            currentWindow = remote.getCurrentWindow(),
            mainWindow = _GET('id'),
            releasePath = null,
            anHttpRequest = new XMLHttpRequest();

    function _GET(string) {
        var query = window.location.search.replace(/\?/, '').split('&') || window.location.hash.replace(/\?/, '').split('&'),
                search = "";
        for (var i in query) {
            if (query[i].indexOf(string + "=") > -1) {
                return query[i].replace(string + "=", "");
            }
        }

        return search;
    }

    function download() {

        anHttpRequest.open("GET", '../version.json', true);
        anHttpRequest.send(null);

        anHttpRequest.onreadystatechange = function () {
            var config = JSON.parse(anHttpRequest.responseText);

            releasePath = config["DEV"] + require('path').join(config.releasePath, config["WORKING_ENVIRONMENT"].toLowerCase(), 'v' + _GET('version') + '.msi').replace(/\\/g, '/');
            require('shell').openExternal(releasePath);
        };

//        var newWindow = window.open(urlBuilds, 'download');
//        currentWindow.hide();
//        setTimeout(function () {
//            newWindow.close();
//        }, 2000);
    }

</script>
<body>
<div class="modal-box in">
    <div class="panel panel-danger">
        <div class="panel-heading"><h3 class="panel-title">Upgrade Available</h3></div>
        <div class="panel-body">A new version is available, Please download and install.</div>
        <div class="panel-footer">
            <a href="javascript:download()">Download</a>
            <a href="javascript:currentWindow.close()" class="pull-right">Cancel</a>

        </div>
    </div>
</div>


</body>
</html>