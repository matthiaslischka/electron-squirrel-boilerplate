<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upgrade</title>
    <link rel="stylesheet" href="styles.css">
</head>

<script>
    var remote = require('remote'),
            utilities = require('../libs/utilities.js'),
            currentWindow = remote.getCurrentWindow(),
            versionUrl = _GET('url'),
            releasePath = null,
            anHttpRequest = new XMLHttpRequest();

    function _GET(string) {
        var query = window.location.search.replace(/\?/, '').split('&') || window.location.hash.replace(/\?/, '').split('&'),
                search = "";
        for (var i in query) {
            if (query[i].indexOf(string + "=") > -1) {
                return query[i].replace(string + "=", "");
            }
        }

        return search;
    }


    !function () {
        var parts = versionUrl.split('/');
        utilities.getVersion(versionUrl, function (status, obj) {
            parts[parts.length - 1] = 'v' + obj.version + '.msi';
            releasePath = parts.join('/');
            document.querySelector('#version').innerHTML = obj.version;
        })
    }();


    function download() {
        require('shell').openExternal(releasePath);
        currentWindow.close();
    }

</script>
<body>
<div class="modal-box in">
    <div class="panel panel-danger">
        <div class="panel-heading"><h3 class="panel-title">Upgrade Available</h3></div>
        <div class="panel-body">A new version is available <span id="version"></span> , Please download and install.
        </div>
        <div class="panel-footer">
            <a href="javascript:download()">Download</a>
            <a href="javascript:currentWindow.close()" class="pull-right">Cancel</a>

        </div>
    </div>
</div>


</body>
</html>